{"ast":null,"code":"var fs = require('fs'),\n  path = require('path'),\n  Hub = require('pkghub'),\n  _ = require('underscore'),\n  render = require('pkghub-render');\nvar isRemote = function (dir) {\n  return dir && (dir.indexOf('http') === 0 || dir.indexOf('https') === 0);\n};\nvar hub = new Hub();\nvar Theme = function (home, defaultTheme, locals) {\n  this.home = home || path.resolve(__dirname, '../', '../', '../');\n  this.meta = this.pkg() || {};\n  this.publics = path.join(this.home, this.meta.public || './public');\n  this.defaults = defaultTheme || null;\n  this.locals = locals || {};\n  if (this.defaults) this.shadow();\n};\nTheme.prototype.config = function (key, value) {\n  if (key && value) this[key] = value;\n  return this[key];\n};\nTheme.prototype.pkg = function () {\n  try {\n    return require(path.join(this.home, './package.json'));\n  } catch (err) {\n    return null;\n  }\n};\nTheme.prototype.shadow = function (selected, callback) {\n  var self = this;\n  var theme = selected || this.defaults;\n  if (!theme) return false;\n  if (isRemote(theme.static)) {\n    if (callback && _.isFunction(callback)) return callback(null);\n    return true;\n  }\n  var statics = path.join(theme.realPath, theme.static || './static');\n  // 创建一个静态资源软链接\n  try {\n    var shadow = path.join(self.publics, theme.name);\n    // mkdirp.sync(shadow);\n    if (!fs.existsSync(shadow)) fs.symlinkSync(statics, shadow, 'dir');\n    if (!callback) return true;\n    return callback(null);\n  } catch (err) {\n    if (!callback) throw err;\n    return callback(err);\n  }\n};\n\n// 列出所有可用主题\n// e.g: theme.list()\nTheme.prototype.list = function (callback) {\n  var self = this;\n  hub.themes(function (err, themes) {\n    if (err) return callback(err);\n    self.themes = themes;\n    if (!callback) return false;\n    return callback(err, themes);\n  });\n};\n\n// 安新主题\n// e.g: candy-theme-default/index, {data: data}, callback\nTheme.prototype.install = function (name, callback) {\n  if (!name) return callback(new Error('theme name required'));\n  var self = this;\n  // 安装到某个目录，name 可以是字符串或者数组\n  hub.install(name, function (err, logs, modules) {\n    if (err) return callback(err);\n    var theme = modules.dependencies[name];\n    self.shadow(theme, function (err) {\n      callback(err, logs, modules);\n    });\n  });\n};\n\n// 使用某个主题下的某一模板渲染\n// e.g: candy-theme-default/index, {data: data}, callback\n// e.g: 使用 shortname 加载：default/index; 会自动加上 candy-theme 这个关键词\nTheme.prototype.render = function (template, data, callback) {\n  // 先判断是不是有效的文件名\n  var pkgname = hub.finder.split(template);\n  var filename = hub.finder.split(template, 'filename');\n  var cb = callback && _.isFunction(callback) ? callback : function () {};\n  if (!pkgname || !filename) return cb(new Error('template not found'));\n  // 判断是不是 shortname, 这里有一个硬编码，需要把这个功能放到 pkghub 中\n  if (pkgname.indexOf('-') === -1 && this.meta.name) pkgname = this.meta.name + '-theme-' + pkgname;\n  // 混合 locals，替代 app.locals 与 res.locals\n  if (!_.isEmpty(this.locals)) data = _.extend(this.locals, data);\n  return render([pkgname, filename].join('/'), data, cb);\n};\nexports = module.exports = Theme;","map":{"version":3,"names":["fs","require","path","Hub","_","render","isRemote","dir","indexOf","hub","Theme","home","defaultTheme","locals","resolve","__dirname","meta","pkg","publics","join","public","defaults","shadow","prototype","config","key","value","err","selected","callback","self","theme","static","isFunction","statics","realPath","name","existsSync","symlinkSync","list","themes","install","Error","logs","modules","dependencies","template","data","pkgname","finder","split","filename","cb","isEmpty","extend","exports","module"],"sources":["E:/programs/AI programs/AIMessageApp/frontend/node_modules/theme/libs/theme.js"],"sourcesContent":["var fs = require('fs'),\n    path = require('path'),\n    Hub = require('pkghub'),\n    _ = require('underscore'),\n    render = require('pkghub-render');\n\nvar isRemote = function(dir) {\n    return dir && (dir.indexOf('http') === 0 || dir.indexOf('https') === 0);\n}\n\nvar hub = new Hub;\n\nvar Theme = function(home, defaultTheme, locals) {\n    this.home = home || path.resolve(__dirname, '../', '../', '../');\n    this.meta = this.pkg() || {};\n    this.publics = path.join(this.home, this.meta.public || './public');\n    this.defaults = defaultTheme || null;\n    this.locals = locals || {};\n    if (this.defaults) this.shadow();\n}\n\nTheme.prototype.config = function(key, value) {\n    if (key && value) this[key] = value;\n    return this[key];\n}\n\nTheme.prototype.pkg = function() {\n    try {\n        return require(path.join(this.home, './package.json'));\n    } catch (err) {\n        return null;\n    }\n}\n\nTheme.prototype.shadow = function(selected, callback) {\n    var self = this;\n    var theme = selected || this.defaults;\n    if (!theme) return false;\n    if (isRemote(theme.static)) {\n        if (callback && _.isFunction(callback)) return callback(null);\n        return true;\n    }\n    var statics = path.join(theme.realPath, theme.static || './static');\n    // 创建一个静态资源软链接\n    try {\n        var shadow = path.join(self.publics, theme.name);\n        // mkdirp.sync(shadow);\n        if (!fs.existsSync(shadow)) fs.symlinkSync(statics, shadow, 'dir');\n        if (!callback) return true;\n        return callback(null);\n    } catch (err) {\n        if (!callback) throw err;\n        return callback(err);\n    }\n}\n\n// 列出所有可用主题\n// e.g: theme.list()\nTheme.prototype.list = function(callback) {\n    var self = this;\n    hub.themes(function(err, themes) {\n        if (err) return callback(err);\n        self.themes = themes;\n        if (!callback) return false;\n        return callback(err, themes);\n    });\n}\n\n// 安新主题\n// e.g: candy-theme-default/index, {data: data}, callback\nTheme.prototype.install = function(name, callback) {\n    if (!name) return callback(new Error('theme name required'));\n    var self = this;\n    // 安装到某个目录，name 可以是字符串或者数组\n    hub.install(name, function(err, logs, modules) {\n        if (err) return callback(err);\n        var theme = modules.dependencies[name];\n        self.shadow(theme, function(err){\n            callback(err, logs, modules);\n        });\n    });\n}\n\n// 使用某个主题下的某一模板渲染\n// e.g: candy-theme-default/index, {data: data}, callback\n// e.g: 使用 shortname 加载：default/index; 会自动加上 candy-theme 这个关键词\nTheme.prototype.render = function(template, data, callback) {\n    // 先判断是不是有效的文件名\n    var pkgname = hub.finder.split(template);\n    var filename = hub.finder.split(template, 'filename');\n    var cb = (callback && _.isFunction(callback)) ? callback : function(){};\n    if (!pkgname || !filename) return cb(new Error('template not found'));\n    // 判断是不是 shortname, 这里有一个硬编码，需要把这个功能放到 pkghub 中\n    if (pkgname.indexOf('-') === -1 && this.meta.name) pkgname = this.meta.name + '-theme-' + pkgname;\n    // 混合 locals，替代 app.locals 与 res.locals\n    if (!_.isEmpty(this.locals)) data = _.extend(this.locals, data);\n    return render([pkgname, filename].join('/'), data, cb);\n};\n\nexports = module.exports = Theme;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}