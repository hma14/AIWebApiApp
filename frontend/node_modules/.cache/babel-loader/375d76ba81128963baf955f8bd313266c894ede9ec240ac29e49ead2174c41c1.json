{"ast":null,"code":"var npm = require(\"./npm\"),\n  _ = require('underscore'),\n  utils = require('./utils'),\n  finder = require('./finder'),\n  settings = require('./settings');\nvar Hub = function (devider) {\n  this.settings = _.clone(settings);\n  this.module = {};\n  this.module.dependencies = {};\n  if (devider) this.settings.devider = devider;\n};\n\n// 配置分隔符\nHub.prototype.config = function (params) {\n  if (params) this.settings = _.extend(this.settings, params);\n  return this.settings;\n};\n\n// 列出所有依赖模块\nHub.prototype.list = function (callback) {\n  var self = this;\n  return npm.ls(function (err, packages) {\n    if (err) return callback(err);\n    var modules = _.clone(packages);\n    var dependencies = modules.dependencies;\n    if (dependencies) {\n      delete modules.dependencies;\n      _.each(dependencies, function (module, name) {\n        dependencies[name] = utils.wash(module);\n      });\n    }\n    modules = utils.wash(modules);\n    modules.dependencies = dependencies;\n    self.module = modules;\n    self.cached = new Date();\n    if (!callback) return;\n    return callback(err, modules);\n  });\n};\nHub.prototype.keywords = function (shortcut, name) {\n  var devider = this.settings.devider;\n  var shortcuts = {\n    '__pkghub_addons': name + devider,\n    '__pkghub_plugins': name + devider + 'plugin' + devider,\n    '__pkghub_themes': name + devider + 'theme' + devider\n  };\n  return shortcuts[shortcut];\n};\nHub.prototype.find = function (name, modules, callback) {\n  // 这里要加一层缓存，不要每次都去 list 一遍模块\n  // 因为 npm 有个问题同时调用两次 load list 会报错。\n  // 这样的话如果在路由里使用基本不现实\n\n  // 先判断是否完全匹配模块名称\n  var pkg = modules.dependencies[name];\n  if (pkg) return callback(null, pkg);\n\n  // 分离模块名称和模板名称\n  // e.g: candy-theme-default/index => candy-theme-default\n  var pkgname = finder.split(name);\n  var filename = finder.split(name, 'filename');\n  if (pkgname && filename) {\n    var m = modules.dependencies[pkgname] || null;\n    if (!m || !m.realPath) return callback(null, m);\n    return callback(null, m, finder.read(m.realPath, filename));\n  }\n\n  // 如果找不到 / 而且不匹配任何模块，进行搜索\n  var result = {};\n  var keyword = this.keywords(name, modules.name) || name;\n  Object.keys(modules.dependencies).forEach(function (name) {\n    if (name.indexOf(keyword) > -1) result[name] = modules.dependencies[name];\n  });\n  if (_.isEmpty(result)) return callback(null, null);\n  var availables = Object.keys(result);\n  if (availables.length === 1) return callback(null, result[availables[0]]);\n  return callback(null, result);\n};\n\n// 加载某一个模块\n// 模块名称可以是全名，也可以是部分名\n// 模块名称可以包涵名称和子文件，比如 candy 或 candy/template.html\n// e.g: name = 'candy/tpl.html', file === tpl.html;\nHub.prototype.load = function (name, callback, force) {\n  var self = this;\n  var cache = self.module;\n  // 如果有缓存，返回缓存内容，这里还应该判断缓存时间, 比如大于多少天自动更新之类\n  // 这里可能出现一个 bug，就是前后查询条件不符合\n  // 这样 hub 可能会缓存到不正确的结果\n  if (self.cached && !force) return self.find(name, cache, callback);\n  // 如果没有缓存，第一次生成缓存\n  return this.list(function (err, modules) {\n    if (err) return callback(err);\n    if (!modules.dependencies) return callback(null, null);\n    return self.find(name, modules, callback);\n  });\n};\n\n// 返回一个模块的相关模块，包括插件和主题\n// e.g: candy-editor 是 candy 的插件，此例中，插件包涵 `candy-` 字符串\nHub.prototype.addons = function (callback) {\n  return this.load('__pkghub_addons', callback);\n};\n\n// 返回一个模块的插件列表\n// 某个包的插件是以 devider 分割的模块名字\n// e.g: candy-editor 是 candy 的插件，此例中，插件包涵 `candy-plugin` 字符串\nHub.prototype.plugins = function (callback) {\n  return this.load('__pkghub_plugins', callback);\n};\n\n// 返回一个模块的主题列表\n// e.g:  candy-theme-balbala 会被返回\nHub.prototype.themes = function (callback) {\n  return this.load('__pkghub_themes', callback);\n};\n\n// 安装一个包，并返回所有依赖\nHub.prototype.install = function (modules, callback, dir) {\n  var self = this;\n  if (_.isString(modules)) modules = [modules];\n  return npm.install(dir, modules, function (err, logs) {\n    if (err) return callback(err);\n    return self.list(function (err, modules) {\n      callback(err, logs, modules);\n    });\n  });\n};\nHub.prototype.finder = finder;\nexports = module.exports = Hub;","map":{"version":3,"names":["npm","require","_","utils","finder","settings","Hub","devider","clone","module","dependencies","prototype","config","params","extend","list","callback","self","ls","err","packages","modules","each","name","wash","cached","Date","keywords","shortcut","shortcuts","find","pkg","pkgname","split","filename","m","realPath","read","result","keyword","Object","keys","forEach","indexOf","isEmpty","availables","length","load","force","cache","addons","plugins","themes","install","dir","isString","logs","exports"],"sources":["E:/programs/AI programs/AIMessageApp/frontend/node_modules/pkghub/libs/pkghub.js"],"sourcesContent":["var npm = require(\"./npm\"),\n    _ = require('underscore'),\n    utils = require('./utils'),\n    finder = require('./finder'),\n    settings = require('./settings');\n\nvar Hub = function(devider) {\n    this.settings = _.clone(settings);\n    this.module = {};\n    this.module.dependencies = {};\n    if (devider) this.settings.devider = devider;\n};\n\n// 配置分隔符\nHub.prototype.config = function(params) {\n    if (params) this.settings = _.extend(this.settings, params);\n    return this.settings;\n};\n\n// 列出所有依赖模块\nHub.prototype.list = function(callback) {\n    var self = this;\n    return npm.ls(function(err, packages) {\n        if (err) return callback(err);\n        var modules = _.clone(packages);\n        var dependencies = modules.dependencies;\n        if (dependencies) {\n            delete modules.dependencies;\n            _.each(dependencies, function(module, name) {\n                dependencies[name] = utils.wash(module);\n            });\n        }\n        modules = utils.wash(modules);\n        modules.dependencies = dependencies;\n        self.module = modules;\n        self.cached = new Date();\n        if (!callback) return;\n        return callback(err, modules);\n    });\n};\n\nHub.prototype.keywords = function(shortcut, name) {\n    var devider = this.settings.devider;\n    var shortcuts = {\n        '__pkghub_addons': name + devider,\n        '__pkghub_plugins': name + devider + 'plugin' + devider,\n        '__pkghub_themes': name + devider + 'theme' + devider\n    }\n    return shortcuts[shortcut];\n}\n\nHub.prototype.find = function(name, modules, callback) {\n\n    // 这里要加一层缓存，不要每次都去 list 一遍模块\n    // 因为 npm 有个问题同时调用两次 load list 会报错。\n    // 这样的话如果在路由里使用基本不现实\n\n    // 先判断是否完全匹配模块名称\n    var pkg = modules.dependencies[name];\n    if (pkg) return callback(null, pkg);\n\n    // 分离模块名称和模板名称\n    // e.g: candy-theme-default/index => candy-theme-default\n    var pkgname = finder.split(name);\n    var filename = finder.split(name, 'filename');\n\n    if (pkgname && filename) {\n        var m = modules.dependencies[pkgname] || null;\n        if (!m || !m.realPath) return callback(null, m);\n        return callback(null, m, finder.read(m.realPath, filename));\n    }\n\n    // 如果找不到 / 而且不匹配任何模块，进行搜索\n    var result = {};\n    var keyword = this.keywords(name, modules.name) || name;\n    Object.keys(modules.dependencies).forEach(function(name) {\n        if (name.indexOf(keyword) > -1) result[name] = modules.dependencies[name];\n    });\n    if (_.isEmpty(result)) return callback(null, null);\n    var availables = Object.keys(result);\n    if (availables.length === 1) return callback(null, result[availables[0]])\n    return callback(null, result);\n\n}\n\n// 加载某一个模块\n// 模块名称可以是全名，也可以是部分名\n// 模块名称可以包涵名称和子文件，比如 candy 或 candy/template.html\n// e.g: name = 'candy/tpl.html', file === tpl.html;\nHub.prototype.load = function(name, callback, force) {\n    var self = this;\n    var cache = self.module;\n    // 如果有缓存，返回缓存内容，这里还应该判断缓存时间, 比如大于多少天自动更新之类\n    // 这里可能出现一个 bug，就是前后查询条件不符合\n    // 这样 hub 可能会缓存到不正确的结果\n    if (self.cached && !force) return self.find(name, cache, callback);\n    // 如果没有缓存，第一次生成缓存\n    return this.list(function(err, modules) {\n        if (err) return callback(err);\n        if (!modules.dependencies) return callback(null, null);\n        return self.find(name, modules, callback);\n    });\n};\n\n// 返回一个模块的相关模块，包括插件和主题\n// e.g: candy-editor 是 candy 的插件，此例中，插件包涵 `candy-` 字符串\nHub.prototype.addons = function(callback) {\n    return this.load('__pkghub_addons', callback);\n};\n\n// 返回一个模块的插件列表\n// 某个包的插件是以 devider 分割的模块名字\n// e.g: candy-editor 是 candy 的插件，此例中，插件包涵 `candy-plugin` 字符串\nHub.prototype.plugins = function(callback) {\n    return this.load('__pkghub_plugins', callback);\n};\n\n// 返回一个模块的主题列表\n// e.g:  candy-theme-balbala 会被返回\nHub.prototype.themes = function(callback) {\n    return this.load('__pkghub_themes', callback);\n};\n\n// 安装一个包，并返回所有依赖\nHub.prototype.install = function(modules, callback, dir) {\n    var self = this;\n    if (_.isString(modules)) modules = [modules];\n    return npm.install(dir, modules, function(err, logs) {\n        if (err) return callback(err);\n        return self.list(function(err, modules) {\n            callback(err, logs, modules);\n        });\n    });\n};\n\nHub.prototype.finder = finder;\n\nexports = module.exports = Hub;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}