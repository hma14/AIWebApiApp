{"ast":null,"code":"/* var fs = require('fs'),\n    path = require('path'),\n    Hub = require('pkghub'),\n    _ = require('underscore'),\n    render = require('pkghub-render'); */\n\nvar fs;\nif (typeof window === \"undefined\") {\n  fs = require(\"fs\");\n}\nvar isRemote = function (dir) {\n  return dir && (dir.indexOf('http') === 0 || dir.indexOf('https') === 0);\n};\nvar hub = new Hub();\nvar Theme = function (home, defaultTheme, locals) {\n  this.home = home || path.resolve(__dirname, '../', '../', '../');\n  this.meta = this.pkg() || {};\n  this.publics = path.join(this.home, this.meta.public || './public');\n  this.defaults = defaultTheme || null;\n  this.locals = locals || {};\n  if (this.defaults) this.shadow();\n};\nTheme.prototype.config = function (key, value) {\n  if (key && value) this[key] = value;\n  return this[key];\n};\nTheme.prototype.pkg = function () {\n  try {\n    return require(path.join(this.home, './package.json'));\n  } catch (err) {\n    return null;\n  }\n};\nTheme.prototype.shadow = function (selected, callback) {\n  var self = this;\n  var theme = selected || this.defaults;\n  if (!theme) return false;\n  if (isRemote(theme.static)) {\n    if (callback && _.isFunction(callback)) return callback(null);\n    return true;\n  }\n  var statics = path.join(theme.realPath, theme.static || './static');\n  // 创建一个静态资源软链接\n  try {\n    var shadow = path.join(self.publics, theme.name);\n    // mkdirp.sync(shadow);\n    if (!fs.existsSync(shadow)) fs.symlinkSync(statics, shadow, 'dir');\n    if (!callback) return true;\n    return callback(null);\n  } catch (err) {\n    if (!callback) throw err;\n    return callback(err);\n  }\n};\n\n// 列出所有可用主题\n// e.g: theme.list()\nTheme.prototype.list = function (callback) {\n  var self = this;\n  hub.themes(function (err, themes) {\n    if (err) return callback(err);\n    self.themes = themes;\n    if (!callback) return false;\n    return callback(err, themes);\n  });\n};\n\n// 安新主题\n// e.g: candy-theme-default/index, {data: data}, callback\nTheme.prototype.install = function (name, callback) {\n  if (!name) return callback(new Error('theme name required'));\n  var self = this;\n  // 安装到某个目录，name 可以是字符串或者数组\n  hub.install(name, function (err, logs, modules) {\n    if (err) return callback(err);\n    var theme = modules.dependencies[name];\n    self.shadow(theme, function (err) {\n      callback(err, logs, modules);\n    });\n  });\n};\n\n// 使用某个主题下的某一模板渲染\n// e.g: candy-theme-default/index, {data: data}, callback\n// e.g: 使用 shortname 加载：default/index; 会自动加上 candy-theme 这个关键词\nTheme.prototype.render = function (template, data, callback) {\n  // 先判断是不是有效的文件名\n  var pkgname = hub.finder.split(template);\n  var filename = hub.finder.split(template, 'filename');\n  var cb = callback && _.isFunction(callback) ? callback : function () {};\n  if (!pkgname || !filename) return cb(new Error('template not found'));\n  // 判断是不是 shortname, 这里有一个硬编码，需要把这个功能放到 pkghub 中\n  if (pkgname.indexOf('-') === -1 && this.meta.name) pkgname = this.meta.name + '-theme-' + pkgname;\n  // 混合 locals，替代 app.locals 与 res.locals\n  if (!_.isEmpty(this.locals)) data = _.extend(this.locals, data);\n  return render([pkgname, filename].join('/'), data, cb);\n};\nexports = module.exports = Theme;","map":{"version":3,"names":["fs","window","require","isRemote","dir","indexOf","hub","Hub","Theme","home","defaultTheme","locals","path","resolve","__dirname","meta","pkg","publics","join","public","defaults","shadow","prototype","config","key","value","err","selected","callback","self","theme","static","_","isFunction","statics","realPath","name","existsSync","symlinkSync","list","themes","install","Error","logs","modules","dependencies","render","template","data","pkgname","finder","split","filename","cb","isEmpty","extend","exports","module"],"sources":["E:/programs/AI programs/AIMessageApp/frontend/node_modules/theme/libs/theme.js"],"sourcesContent":["/* var fs = require('fs'),\n    path = require('path'),\n    Hub = require('pkghub'),\n    _ = require('underscore'),\n    render = require('pkghub-render'); */\n\nvar fs;\nif (typeof window === \"undefined\") {\n  fs = require(\"fs\");\n}\n\nvar isRemote = function(dir) {\n    return dir && (dir.indexOf('http') === 0 || dir.indexOf('https') === 0);\n}\n\nvar hub = new Hub;\n\nvar Theme = function(home, defaultTheme, locals) {\n    this.home = home || path.resolve(__dirname, '../', '../', '../');\n    this.meta = this.pkg() || {};\n    this.publics = path.join(this.home, this.meta.public || './public');\n    this.defaults = defaultTheme || null;\n    this.locals = locals || {};\n    if (this.defaults) this.shadow();\n}\n\nTheme.prototype.config = function(key, value) {\n    if (key && value) this[key] = value;\n    return this[key];\n}\n\nTheme.prototype.pkg = function() {\n    try {\n        return require(path.join(this.home, './package.json'));\n    } catch (err) {\n        return null;\n    }\n}\n\nTheme.prototype.shadow = function(selected, callback) {\n    var self = this;\n    var theme = selected || this.defaults;\n    if (!theme) return false;\n    if (isRemote(theme.static)) {\n        if (callback && _.isFunction(callback)) return callback(null);\n        return true;\n    }\n    var statics = path.join(theme.realPath, theme.static || './static');\n    // 创建一个静态资源软链接\n    try {\n        var shadow = path.join(self.publics, theme.name);\n        // mkdirp.sync(shadow);\n        if (!fs.existsSync(shadow)) fs.symlinkSync(statics, shadow, 'dir');\n        if (!callback) return true;\n        return callback(null);\n    } catch (err) {\n        if (!callback) throw err;\n        return callback(err);\n    }\n}\n\n// 列出所有可用主题\n// e.g: theme.list()\nTheme.prototype.list = function(callback) {\n    var self = this;\n    hub.themes(function(err, themes) {\n        if (err) return callback(err);\n        self.themes = themes;\n        if (!callback) return false;\n        return callback(err, themes);\n    });\n}\n\n// 安新主题\n// e.g: candy-theme-default/index, {data: data}, callback\nTheme.prototype.install = function(name, callback) {\n    if (!name) return callback(new Error('theme name required'));\n    var self = this;\n    // 安装到某个目录，name 可以是字符串或者数组\n    hub.install(name, function(err, logs, modules) {\n        if (err) return callback(err);\n        var theme = modules.dependencies[name];\n        self.shadow(theme, function(err){\n            callback(err, logs, modules);\n        });\n    });\n}\n\n// 使用某个主题下的某一模板渲染\n// e.g: candy-theme-default/index, {data: data}, callback\n// e.g: 使用 shortname 加载：default/index; 会自动加上 candy-theme 这个关键词\nTheme.prototype.render = function(template, data, callback) {\n    // 先判断是不是有效的文件名\n    var pkgname = hub.finder.split(template);\n    var filename = hub.finder.split(template, 'filename');\n    var cb = (callback && _.isFunction(callback)) ? callback : function(){};\n    if (!pkgname || !filename) return cb(new Error('template not found'));\n    // 判断是不是 shortname, 这里有一个硬编码，需要把这个功能放到 pkghub 中\n    if (pkgname.indexOf('-') === -1 && this.meta.name) pkgname = this.meta.name + '-theme-' + pkgname;\n    // 混合 locals，替代 app.locals 与 res.locals\n    if (!_.isEmpty(this.locals)) data = _.extend(this.locals, data);\n    return render([pkgname, filename].join('/'), data, cb);\n};\n\nexports = module.exports = Theme;"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,EAAE;AACN,IAAI,OAAOC,MAAM,KAAK,WAAW,EAAE;EACjCD,EAAE,GAAGE,OAAO,CAAC,IAAI,CAAC;AACpB;AAEA,IAAIC,QAAQ,GAAG,SAAAA,CAASC,GAAG,EAAE;EACzB,OAAOA,GAAG,KAAKA,GAAG,CAACC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAID,GAAG,CAACC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AAC3E,CAAC;AAED,IAAIC,GAAG,GAAG,IAAIC,GAAG,CAAD,CAAC;AAEjB,IAAIC,KAAK,GAAG,SAAAA,CAASC,IAAI,EAAEC,YAAY,EAAEC,MAAM,EAAE;EAC7C,IAAI,CAACF,IAAI,GAAGA,IAAI,IAAIG,IAAI,CAACC,OAAO,CAACC,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC;EAChE,IAAI,CAACC,IAAI,GAAG,IAAI,CAACC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;EAC5B,IAAI,CAACC,OAAO,GAAGL,IAAI,CAACM,IAAI,CAAC,IAAI,CAACT,IAAI,EAAE,IAAI,CAACM,IAAI,CAACI,MAAM,IAAI,UAAU,CAAC;EACnE,IAAI,CAACC,QAAQ,GAAGV,YAAY,IAAI,IAAI;EACpC,IAAI,CAACC,MAAM,GAAGA,MAAM,IAAI,CAAC,CAAC;EAC1B,IAAI,IAAI,CAACS,QAAQ,EAAE,IAAI,CAACC,MAAM,CAAC,CAAC;AACpC,CAAC;AAEDb,KAAK,CAACc,SAAS,CAACC,MAAM,GAAG,UAASC,GAAG,EAAEC,KAAK,EAAE;EAC1C,IAAID,GAAG,IAAIC,KAAK,EAAE,IAAI,CAACD,GAAG,CAAC,GAAGC,KAAK;EACnC,OAAO,IAAI,CAACD,GAAG,CAAC;AACpB,CAAC;AAEDhB,KAAK,CAACc,SAAS,CAACN,GAAG,GAAG,YAAW;EAC7B,IAAI;IACA,OAAOd,OAAO,CAACU,IAAI,CAACM,IAAI,CAAC,IAAI,CAACT,IAAI,EAAE,gBAAgB,CAAC,CAAC;EAC1D,CAAC,CAAC,OAAOiB,GAAG,EAAE;IACV,OAAO,IAAI;EACf;AACJ,CAAC;AAEDlB,KAAK,CAACc,SAAS,CAACD,MAAM,GAAG,UAASM,QAAQ,EAAEC,QAAQ,EAAE;EAClD,IAAIC,IAAI,GAAG,IAAI;EACf,IAAIC,KAAK,GAAGH,QAAQ,IAAI,IAAI,CAACP,QAAQ;EACrC,IAAI,CAACU,KAAK,EAAE,OAAO,KAAK;EACxB,IAAI3B,QAAQ,CAAC2B,KAAK,CAACC,MAAM,CAAC,EAAE;IACxB,IAAIH,QAAQ,IAAII,CAAC,CAACC,UAAU,CAACL,QAAQ,CAAC,EAAE,OAAOA,QAAQ,CAAC,IAAI,CAAC;IAC7D,OAAO,IAAI;EACf;EACA,IAAIM,OAAO,GAAGtB,IAAI,CAACM,IAAI,CAACY,KAAK,CAACK,QAAQ,EAAEL,KAAK,CAACC,MAAM,IAAI,UAAU,CAAC;EACnE;EACA,IAAI;IACA,IAAIV,MAAM,GAAGT,IAAI,CAACM,IAAI,CAACW,IAAI,CAACZ,OAAO,EAAEa,KAAK,CAACM,IAAI,CAAC;IAChD;IACA,IAAI,CAACpC,EAAE,CAACqC,UAAU,CAAChB,MAAM,CAAC,EAAErB,EAAE,CAACsC,WAAW,CAACJ,OAAO,EAAEb,MAAM,EAAE,KAAK,CAAC;IAClE,IAAI,CAACO,QAAQ,EAAE,OAAO,IAAI;IAC1B,OAAOA,QAAQ,CAAC,IAAI,CAAC;EACzB,CAAC,CAAC,OAAOF,GAAG,EAAE;IACV,IAAI,CAACE,QAAQ,EAAE,MAAMF,GAAG;IACxB,OAAOE,QAAQ,CAACF,GAAG,CAAC;EACxB;AACJ,CAAC;;AAED;AACA;AACAlB,KAAK,CAACc,SAAS,CAACiB,IAAI,GAAG,UAASX,QAAQ,EAAE;EACtC,IAAIC,IAAI,GAAG,IAAI;EACfvB,GAAG,CAACkC,MAAM,CAAC,UAASd,GAAG,EAAEc,MAAM,EAAE;IAC7B,IAAId,GAAG,EAAE,OAAOE,QAAQ,CAACF,GAAG,CAAC;IAC7BG,IAAI,CAACW,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACZ,QAAQ,EAAE,OAAO,KAAK;IAC3B,OAAOA,QAAQ,CAACF,GAAG,EAAEc,MAAM,CAAC;EAChC,CAAC,CAAC;AACN,CAAC;;AAED;AACA;AACAhC,KAAK,CAACc,SAAS,CAACmB,OAAO,GAAG,UAASL,IAAI,EAAER,QAAQ,EAAE;EAC/C,IAAI,CAACQ,IAAI,EAAE,OAAOR,QAAQ,CAAC,IAAIc,KAAK,CAAC,qBAAqB,CAAC,CAAC;EAC5D,IAAIb,IAAI,GAAG,IAAI;EACf;EACAvB,GAAG,CAACmC,OAAO,CAACL,IAAI,EAAE,UAASV,GAAG,EAAEiB,IAAI,EAAEC,OAAO,EAAE;IAC3C,IAAIlB,GAAG,EAAE,OAAOE,QAAQ,CAACF,GAAG,CAAC;IAC7B,IAAII,KAAK,GAAGc,OAAO,CAACC,YAAY,CAACT,IAAI,CAAC;IACtCP,IAAI,CAACR,MAAM,CAACS,KAAK,EAAE,UAASJ,GAAG,EAAC;MAC5BE,QAAQ,CAACF,GAAG,EAAEiB,IAAI,EAAEC,OAAO,CAAC;IAChC,CAAC,CAAC;EACN,CAAC,CAAC;AACN,CAAC;;AAED;AACA;AACA;AACApC,KAAK,CAACc,SAAS,CAACwB,MAAM,GAAG,UAASC,QAAQ,EAAEC,IAAI,EAAEpB,QAAQ,EAAE;EACxD;EACA,IAAIqB,OAAO,GAAG3C,GAAG,CAAC4C,MAAM,CAACC,KAAK,CAACJ,QAAQ,CAAC;EACxC,IAAIK,QAAQ,GAAG9C,GAAG,CAAC4C,MAAM,CAACC,KAAK,CAACJ,QAAQ,EAAE,UAAU,CAAC;EACrD,IAAIM,EAAE,GAAIzB,QAAQ,IAAII,CAAC,CAACC,UAAU,CAACL,QAAQ,CAAC,GAAIA,QAAQ,GAAG,YAAU,CAAC,CAAC;EACvE,IAAI,CAACqB,OAAO,IAAI,CAACG,QAAQ,EAAE,OAAOC,EAAE,CAAC,IAAIX,KAAK,CAAC,oBAAoB,CAAC,CAAC;EACrE;EACA,IAAIO,OAAO,CAAC5C,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAACU,IAAI,CAACqB,IAAI,EAAEa,OAAO,GAAG,IAAI,CAAClC,IAAI,CAACqB,IAAI,GAAG,SAAS,GAAGa,OAAO;EACjG;EACA,IAAI,CAACjB,CAAC,CAACsB,OAAO,CAAC,IAAI,CAAC3C,MAAM,CAAC,EAAEqC,IAAI,GAAGhB,CAAC,CAACuB,MAAM,CAAC,IAAI,CAAC5C,MAAM,EAAEqC,IAAI,CAAC;EAC/D,OAAOF,MAAM,CAAC,CAACG,OAAO,EAAEG,QAAQ,CAAC,CAAClC,IAAI,CAAC,GAAG,CAAC,EAAE8B,IAAI,EAAEK,EAAE,CAAC;AAC1D,CAAC;AAEDG,OAAO,GAAGC,MAAM,CAACD,OAAO,GAAGhD,KAAK","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}